<html ng-app>
<head>
<style>
.not_display{
    display: none;
}
span.highlight {
background-color: #C6D9DB; cursor: pointer; }
span.splink {
color: #0A5794; cursor: pointer; }
</style>
<meta charset="UTF-8">
<!-- Put your page Title here -->
<title>	Cache Server Page </title>
<meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.3/angular.min.js"></script>
 <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
 <script type="text/javascript" src="js/bootstrap.min.js"></script>
 <script type="text/javascript" src="js/tinymce.min.js"></script>
 <script src="js/jquery.slimscroll.min.js" type="text/javascript"></script>
 <script src='js/fastclick.min.js'></script>
 <script src="js/app.min.js" type="text/javascript"></script>
 
 <link rel="stylesheet" href="css/bootstrap.min.css">
 <link href="css/AdminLTE.min.css" rel="stylesheet" type="text/css" />
 <link href="css/_all-skins.min.css" rel="stylesheet" type="text/css" />
 <link href="css/simple-sidebar.css" rel="stylesheet">

  <script type="text/javascript"> 
  jQuery(document).ready(function(){
  	$("#client_on").on('click', function () {
	  	$("#client_sub").toggleClass("not_display");
  	});
  	$("#object_on").on('click', function () {
  		$("#object_sub").toggleClass("not_display");
  	});
  	$("#gang_on").on('click', function () {
  		$("#gang_sub").toggleClass("not_display");
  	});
  	$("#bus_on").on('click', function () {
  		$("#bus_sub").toggleClass("not_display");
  	});
  	$("#news_on").on('click', function () {
  		$("#news_sub").toggleClass("not_display");
  	});
 var minlen = 3; // минимальная длина слова
 var paddingtop = 30; // отступ сверху при прокрутке
 var scrollspeed = 200; // время прокрутки
 var keyint = 1000; // интервал между нажатиями клавиш
 var term = '';
 var n = 0;
 var time_keyup = 0;
 var time_search = 0;
 
 jQuery('body').delegate('#spgo', 'click', function(){
  jQuery('body,html').animate({scrollTop: jQuery('span.highlight:first').offset().top-paddingtop}, scrollspeed); // переход к первому фрагменту
 });
 
 function dosearch() {
  term = jQuery('#spterm').val();
  jQuery('span.highlight').each(function(){ //удаляем старую подсветку
   jQuery(this).after(jQuery(this).html()).remove();  
  });
  var t = '';
  jQuery('div#news_sub').each(function(){ // в селекторе задаем область поиска
   jQuery(this).html(jQuery(this).html().replace(new RegExp(term, 'ig'), '<span class="highlight">$&</span>')); // выделяем найденные фрагменты
   n = jQuery('span.highlight').length; // количество найденных фрагментов
   console.log('n = '+n);
   if (n==0)
    jQuery('#spresult').html('Ничего не найдено');
   else
    jQuery('#spresult').html('Результатов: '+n+'. <span class="splink" id="spgo">Перейти</span>'); 
   if (n>1) // если больше одного фрагмента, то добавляем переход между ними
   {
    var i = 0;
    jQuery('span.highlight').each(function(i){
     jQuery(this).attr('n', i++); // нумеруем фрагменты, более простого способа искать следующий элемент не нашел
    });
    jQuery('span.highlight').not(':last').attr({title: 'Нажмите, чтобы перейти к следующему фрагменту'}).click(function(){ // всем фрагментам, кроме последнего, добавляем подсказку
     jQuery('body,html').animate({scrollTop: jQuery('span.highlight:gt('+jQuery(this).attr('n')+'):first').offset().top-paddingtop}, scrollspeed); // переход к следующему фрагменту
    });
    jQuery('span.highlight:last').attr({title: 'Нажмите, чтобы вернуться к форме поиска'}).click(function(){
     jQuery('body,html').animate({scrollTop: jQuery('#spterm').offset().top-paddingtop}, scrollspeed); // переход к форме поиска
    });
   } 
  });
 }

 jQuery('#spterm').keyup(function(){
  var d1 = new Date();
  time_keyup = d1.getTime();
  if (jQuery('#spterm').val()!=term) // проверяем, изменилась ли строка
   if (jQuery('#spterm').val().length>=minlen) { // проверяем длину строки
    setTimeout(function(){ // ждем следующего нажатия
     var d2 = new Date();
     time_search = d2.getTime();
     if (time_search-time_keyup>=keyint) // проверяем интервал между нажатиями
      dosearch(); // если все в порядке, приступаем к поиску
    }, keyint); 
   }
   else
    jQuery('#spresult').html('&nbsp'); // если строка короткая, убираем текст из DIVа с результатом 
 });	
 
 if (window.location.hash!="") // бонус
 {
  var t = window.location.hash.substr(1, 50); // вырезаем текст
  jQuery('#spterm').val(t).keyup(); // вставляем его в форму поиска
  jQuery('#spgo').click();
 }
  });
  </script> 
 
<script language="javascript">
function ctrl($scope,$http) {
	// Запрос GET к REST web API
	$scope.getCompanies=function() { // Изменение getCompanies на глобальную функцию
        $http.get("/rest/json/companies").success(function(data) {
	         // Помещаем ответ сервера в переменную companies
            $scope.companies=data.children; 
        }).error(function(data, status) {
	             // Вывод информации об ошибке, если таковая возникнет
            alert("["+status+"] Ошибка при загрузки компаний! ["+data+"]");
        });
    };
   
   	// Создать новую компанию
	$scope.create = function (company){ 
	   $http.post("/rest/json/company",company) 
	   .success(function(data){$scope.getCompanies();$scope.alertzone="Добавили компанию "+company.Name;}).error(function(data,status){
		$scope.alertzone="["+status+"] Ошибка добавления компании :( ["+data+"]"; });
	}  

	// Обновить существующую компанию
   $scope.update = function (company){
	   $http.put("/rest/json/company/"+company.ID,company)
		.success(function(data){$scope.alertzone="Обновили компанию "+company.Name;}).error(function(data,status){ // поменял alert(....); на alertzone
		$scope.alertzone="["+status+"] Ошибка обновления имени компании :( ["+data+"]"; });
	}    
		    
	// Удалить компанию
	$scope.delete = function (company){
		$http.delete("/rest/json/company/"+company.ID)
		.success(function(data){$scope.getCompanies();$scope.alertzone="Удалили компанию "+company.Name;}).error(function(data,status){
			$scope.alertzone="["+status+"] Ошибка удаления компании :( ["+data+"]"; });
	}
	
	$scope.getObjects=function() {
        $http.get("/rest/json/objects").success(function(data) {
	         // Помещаем ответ сервера в переменную objects
            $scope.objects=data.children; 
        }).error(function(data, status) {
	             // Вывод информации об ошибке, если таковая возникнет
            alert("["+status+"] Ошибка при загрузки товаров! ["+data+"]");
        });
    };
   
   	// Создать новый объект
	$scope.create1 = function (object){ 
	   $http.post("/rest/json/object",object) 
	   .success(function(data){$scope.getObjects();$scope.alertzone1="Добавили товар "+object.Object;}).error(function(data,status){
		$scope.alertzone1="["+status+"] Ошибка добавления товара :( ["+data+"]"; });
	}  

	// Обновить существующую компанию
   $scope.update1 = function (object){
	   $http.put("/rest/json/object/"+object.ID,object)
		.success(function(data){$scope.alertzone1="Обновили товар "+object.Object;}).error(function(data,status){ // поменял alert(....); на alertzone
		$scope.alertzone1="["+status+"] Ошибка обновления имени товара :( ["+data+"]"; });
	}   
		    
	// Удалить товар
	$scope.delete1 = function (object){
		$http.delete("/rest/json/object/"+object.ID)
		.success(function(data){$scope.getObjects();$scope.alertzone1="Удалили товар "+object.Object;}).error(function(data,status){
			$scope.alertzone1="["+status+"] Ошибка удаления товара :( ["+data+"]"; });
			console.log('Сработало удаление');
	}
	
	// Запрос GET к REST web API
	$scope.getGangs=function() { // Изменение getGangs на глобальную функцию
        $http.get("/rest/json/gangs").success(function(data) {
	         // Помещаем ответ сервера в переменную companies
            $scope.gangs=data.children; 
        }).error(function(data, status) {
	             // Вывод информации об ошибке, если таковая возникнет
            alert("["+status+"] Ошибка при загрузки сотрудников! ["+data+"]");
        });
    };
   
   	// Создать нового сотрудника
	$scope.create2 = function (gang){ 
	   $http.post("/rest/json/gang",gang) 
	   .success(function(data){$scope.getGangs();$scope.alertzone2="Добавили сотрудника "+gang.Name;}).error(function(data,status){
		$scope.alertzone2="["+status+"] Ошибка добавления сотрудника :( ["+data+"]"; });
	}  

	// Обновить существующую сотрудника
   $scope.update2 = function (gang){
	   $http.put("/rest/json/gang/"+gang.ID,gang)
		.success(function(data){$scope.alertzone2="Обновили сотрудника "+gang.Name;}).error(function(data,status){ // поменял alert(....); на alertzone
		$scope.alertzone2="["+status+"] Ошибка обновления имени сотрудника :( ["+data+"]"; });
	}    
		    
	// Удалить компанию
	$scope.delete2 = function (gang){
		$http.delete("/rest/json/gang/"+gang.ID)
		.success(function(data){$scope.getGangs();$scope.alertzone2="Удалили сотрудника "+gang.Name;}).error(function(data,status){
			$scope.alertzone2="["+status+"] Ошибка удаления сотрудника :( ["+data+"]"; });
	}
	
	// Запрос GET к REST web API
	$scope.getBuss=function() { // Изменение getBuss на глобальную функцию
        $http.get("/rest/json/buss").success(function(data) {
	         // Помещаем ответ сервера в переменную buss
            $scope.buss=data.children; 
        }).error(function(data, status) {
	             // Вывод информации об ошибке, если таковая возникнет
            alert("["+status+"] Ошибка при загрузки бухгалтерии! ["+data+"]");
        });
    };
   
   	// Создать новую компанию
	$scope.create3 = function (bus){ 
	   $http.post("/rest/json/bus",bus) 
	   .success(function(data){$scope.getBuss();$scope.alertzone3="Добавили отчет "+bus.Month;}).error(function(data,status){
		$scope.alertzone3="["+status+"] Ошибка добавления отчета :( ["+data+"]"; });
	}  

	// Обновить существующую компанию
   $scope.update3 = function (bus){
	   $http.put("/rest/json/bus/"+bus.ID,bus)
		.success(function(data){$scope.alertzone3="Обновили отчет "+bus.Month;}).error(function(data,status){ // поменял alert(....); на alertzone
		$scope.alertzone3="["+status+"] Ошибка обновления месяца в отчете :( ["+data+"]"; });
	}    
		    
	// Удалить компанию
	$scope.delete3 = function (bus){
		$http.delete("/rest/json/bus/"+bus.ID)
		.success(function(data){$scope.getBuss();$scope.alertzone3="Удалили отчет за "+bus.Month;}).error(function(data,status){
			$scope.alertzone3="["+status+"] Ошибка удаления отчета :( ["+data+"]"; });
	}
	
	// Запрос GET к REST web API
	$scope.getNewss=function() { // Изменение getNewss на глобальную функцию
        $http.get("/rest/json/newss").success(function(data) {
	         // Помещаем ответ сервера в переменную buss
            $scope.newss=data.children; 
        }).error(function(data, status) {
	             // Вывод информации об ошибке, если таковая возникнет
            alert("["+status+"] Ошибка при загрузки Новостей! ["+data+"]");
        });
    };
   
   	// Создать новую компанию
	$scope.create4 = function (news){ 
	   $http.post("/rest/json/news",news) 
	   .success(function(data){$scope.getNewss();$scope.alertzone4="Добавили новость "+news.Title;}).error(function(data,status){
		$scope.alertzone4="["+status+"] Ошибка добавления новости :( ["+data+"]"; });
	}  

	// Обновить существующую компанию
   $scope.update4 = function (news){
	   $http.put("/rest/json/news/"+news.ID,news)
		.success(function(data){$scope.alertzone4="Обновили новость "+news.Title;}).error(function(data,status){ // поменял alert(....); на alertzone
		$scope.alertzone4="["+status+"] Ошибка обновления новости :( ["+data+"]"; });
	}    
		    
	// Удалить компанию
	$scope.delete4 = function (news){
		$http.delete("/rest/json/news/"+news.ID)
		.success(function(data){$scope.getNewss();$scope.alertzone4="Удалили новость "+news.Title;}).error(function(data,status){
		$scope.alertzone4="["+status+"] Ошибка удаления новости :( ["+data+"]"; });
	}                  
};     
</script>

 <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
 <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>

</head>

<body ng-controller="ctrl" ng-init="getCompanies(); getObjects(); getGangs(); getBuss(); getNewss();" class="skin-green">
	<div class="wrapper">
    <header class="main-header">
        <a href="" class="ajax logo">Мебельный салон</a>

        <nav class="navbar navbar-static-top" role="navigation">

            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <!-- {menu_0}-->
                    <li><a href="#" id="news_on">Главная</a></li>
                </ul>
            </div>
        </nav>
    </header>
    <aside class="main-sidebar">
        <section class="sidebar">
        
            <form action="/user/view/" method="post" class="sidebar-form">
            <div class="input-group">
                 <input id="spterm" type="text" class="form-control" name="spterm" placeholder="Что искать?">
            </div>
            </form>
        
            <ul class="sidebar-menu">
                <li class="header">Навигация</li>
                <li><a href="#" id="client_on">Клиенты</a></li>
                <li><a href="#" id="gang_on">Сотрудники</a></li>
                <li><a href="#" id="bus_on">Бухгалтерия</a></li>
                <li><a href="#" id="object_on">Товары</a></li>
            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>
    <div class="content-wrapper">
        <section class="content2">
            <!-- Main content -->
            <div class="box box-default">
                <div class="box-header with-border">
                 <h3 class="box-title titleContent">Мебельный салон</h3>
                </div>
                <div class="box-body" >
                
                <div id="spresult">&nbsp;</div>
                
                <!-- Начало таблицы 'КЛИЕНТЫ' -->
                <div id="client_sub" class="not_display">
                <big>Таблица <b>'КЛИЕНТЫ'</b></big>
				<h4 ng-model="alertzone"><font color=red>{{alertzone}}</font></h4>
				<form class="form-inline" name="compCreateForm" ng-model="company" ng-submit="create(company); company='';">
    			<input type="text" class="form-control" ng-model="company.Name" placeholder="Добавить компанию"/>
    			
    			<select ng-model="company.Object" class="form-control">
  					<option ng-repeat="company in companies">{{company.Object}}</option>
				</select>
    			
    			<input type="text" class="form-control" ng-model="company.Amount" placeholder="Количество"/>
    			<input type="text" class="form-control" ng-model="company.Price" placeholder="Цена"/>
    			<input type="submit" class="btn btn-success" value="Добавить"/>
				</form>
				<div ng-repeat="company in companies">
				<form name="compForm" ng-submit="update(company); compForm.$setPristine();">
				<table class="table company">
    				<tr>
    					<td><center><input type="submit" class="btn btn-info" value="V" ng-show="compForm.$dirty"/></center></td>
    					<td><input type="text" ng-model="company.Name"/></td>
    					<td><input type="text" ng-model="company.Object"/></td>
    					<td><input type="text" ng-model="company.Amount"/></td>
    					<td><input type="text" ng-model="company.Price"/></td>
    					<td><center><input type="button" class="btn btn-danger" value="X" ng-click="delete(company);"/></center></td>
    				</tr>
					</form>
    			</table>
    			</form>
				</div>
				</div>
				<!-- Конец таблицы 'КЛИЕНТЫ' -->
				
				<!-- Начало таблицы 'ТОВАРЫ' -->
				<div id="object_sub" class="not_display">
				<big>Таблица <b>'ТОВАРЫ'</b></big>
				<h4 ng-model="alertzone1"><font color=red>{{alertzone1}}</font></h4>
				<form class="form-inline" name="objCreateForm" ng-model="object" ng-submit="create1(object); object='';">
    			<input type="text" class="form-control" ng-model="object.Object" placeholder="Добавить товар"/>
    			<input type="date" class="form-control" ng-model="object.DataAdd" placeholder="Дата заказа"/>
    			<input type="date" class="form-control" ng-model="object.DataEnd" placeholder="Дата изготовления"/>
    			<input type="submit" class="btn btn-success" value="Добавить"/>
				</form>
				<div ng-repeat="object in objects">
				<form name="objForm" ng-submit="update1(object); objForm.$setPristine();">
				<table class="table object">
    				<tr>
    					<td><center><input type="submit" class="btn btn-info" value="V" ng-show="objForm.$dirty"/></center></td>
    					<td><input type="text" ng-model="object.Object"/></td>
    					<td><input type="text" ng-model="object.DataAdd"/></td>
    					<td><input type="text" ng-model="object.DataEnd"/></td>
    					<td><center><input type="button" class="btn btn-danger" value="X" ng-click="delete1(object);"/></center></td>
    				</tr>
					</form>
    			</table>
    			</form>
				</div>
				</div>
				<!-- Конец таблицы 'ТОВАРЫ' -->
				
				 <!-- Начало таблицы 'СОТРУДНИКИ' -->
                <div id="gang_sub" class="not_display">
                <big>Таблица <b>'СОТРУДНИКИ'</b></big>
				<h4 ng-model="alertzone2"><font color=red>{{alertzone2}}</font></h4>
				<form class="form-inline" name="gangCreateForm" ng-model="gang" ng-submit="create2(gang); gang='';">
    			<input type="text" class="form-control" ng-model="gang.Name" placeholder="Добавить сотрудника"/>
    			<input type="text" class="form-control" ng-model="gang.Rang" placeholder="Должность"/>
    			<input type="text" class="form-control" ng-model="gang.Phone" placeholder="Телефон"/>
    			<input type="text" class="form-control" ng-model="gang.PayDay" placeholder="Зарплата"/>
    			<input type="submit" class="btn btn-success" value="Добавить"/>
				</form>
				<div ng-repeat="gang in gangs">
				<form name="gangForm" ng-submit="update2(gang); gangForm.$setPristine();">
				<table class="table gang">
    				<tr>
    					<td><center><input type="submit" class="btn btn-info" value="V" ng-show="gangForm.$dirty"/></center></td>
    					<td><input type="text" ng-model="gang.Name"/></td>
    					<td><input type="text" ng-model="gang.Rang"/></td>
    					<td><input type="text" ng-model="gang.Phone"/></td>
    					<td><input type="text" ng-model="gang.PayDay"/></td>
    					<td><center><input type="button" class="btn btn-danger" value="X" ng-click="delete2(gang);"/></center></td>
    				</tr>
					</form>
    			</table>
    			</form>
				</div>
				</div>
				<!-- Конец таблицы 'СОТРУДНИКИ' -->
				
				<!-- Начало таблицы 'БУХГАЛТЕРИЯ' -->
                <div id="bus_sub" class="not_display">
                <big>Таблица <b>'БУХГАЛТЕРИЯ'</b></big>
				<h4 ng-model="alertzone3"><font color=red>{{alertzone3}}</font></h4>
				<form class="form-inline" name="businessCreateForm" ng-model="bus" ng-submit="create3(bus); bus='';">
    			<input type="month" view="name" class="form-control" ng-model="bus.Month" placeholder="Добавить месяц"/>
    			<input type="text" class="form-control" ng-model="bus.Count" placeholder="Количество товара"/>
    			<input type="text" class="form-control" ng-model="bus.Keep" placeholder="Выручка"/>
    			<input type="submit" class="btn btn-success" value="Добавить"/>
				</form>
				<div ng-repeat="bus in buss">
				<form name="busForm" ng-submit="update3(bus); busForm.$setPristine();">
				<table class="table bus">
    				<tr>
    					<td><center><input type="submit" class="btn btn-info" value="V" ng-show="busForm.$dirty"/></center></td>
    					<td><input type="text" ng-model="bus.Month"/></td>
    					<td><input type="text" ng-model="bus.Count"/></td>
    					<td><input type="text" ng-model="bus.Keep"/></td>
    					<td><center><input type="button" class="btn btn-danger" value="X" ng-click="delete3(bus);"/></center></td>
    				</tr>
					</form>
    			</table>
    			</form>
				</div>
				</div>
				<!-- Конец таблицы 'БУХГАЛТЕРИЯ' -->
				
				<!-- Начало таблицы 'НОВОСТИ' -->
                <div id="news_sub" class="not_display">
                <big>Новости</big>
				<h4 ng-model="alertzone4"><font color=red>{{alertzone4}}</font></h4>
				<div ng-repeat="news in newss">
				<form name="newsForm" ng-submit="update4(news); newsForm.$setPristine();">
    			<h2>{{news.Title}}<input type="button" class="btn btn-danger" value="X" ng-click="delete4(news);"/></h2>{{news.Date}}<br>
    			<big>{{news.Text}}</big>
    			</form>
    			</div>
				<form class="form-inline" name="newsCreateForm" ng-model="news" ng-submit="create4(news); news='';">
    			<input type="text" class="form-control" ng-model="news.Title" placeholder="Добавить заголовок"/>
    			<input type="text" class="form-control" ng-model="news.Text" placeholder="Текст"/>
    			<input type="date" class="form-control" ng-model="news.Date" placeholder="Дата"/>
    			<input type="submit" class="btn btn-success" value="Добавить"/>
				</form>
				</div>
				<!-- Конец таблицы 'БУХГАЛТЕРИЯ' -->
				
                </div><!-- /.box-body -->
            </div><!-- /.box -->
        </section>
    </div>
</div><!-- /.content-wrapper -->

<footer class="main-footer">
    <div class="pull-right hidden-xs">
        <b>© 2017</b>
    </div>
    <b>Гайсин Ришат</b>
    - <a href="http://www.vk.com/rishat1c">vk.com/rishat1c</a>
</footer>
</body>
</html>